{% extends "base.html" %}
{% block content %}



{% if vehicle.is_available and vehicle.status == "approved" %}
    <span class="badge bg-success">Available</span>
{% else %}
    <span class="badge bg-danger">Not Available</span>
{% endif %}
{% if active_booking %}
    <div class="alert alert-info mt-3">
        <strong>ðŸš— Vehicle On Service</strong><br>
        Time remaining:
        <span id="time-remaining" class="fw-bold text-danger"></span>
    </div>
{% endif %}
{% if active_booking %}
<script>
    const SERVICE_STARTED_AT = "{{ active_booking.service_started_at|date:'c' }}";
    const SERVICE_TYPE = "{{ active_booking.service_type }}";
    const TOTAL_HOURS = {{ active_booking.total_hours|default:0 }};
    const TOTAL_DAYS = {{ active_booking.total_days|default:0 }};
</script>
{% endif %}



<div class="container py-4">

    <div class="row g-4">
        <div class="col-md-6">
            <img src="{{ vehicle.image.url }}" class="img-fluid rounded shadow">
        </div>

        <div class="col-md-6">
            <h2 class="fw-bold">{{ vehicle.name }}</h2>
            <p class="text-muted">{{ vehicle.vehicle_type|title }}</p>

            <h4 class="fw-semibold">
                Rs. {{ vehicle.price_per_day }} / day
            </h4>
            <h4 class="fw-semibold">
                Rs. {{ vehicle.price_per_hour }} / hour
            </h4>
            <p class="mt-3">
                <strong>Pickup Address:</strong> {{ vehicle.pickup_address }}
            </p>
            <div class="mt-3 mb-4">
            <div id="map" style="height: 300px; border-radius: 8px;"></div>
            </div>
            <p class="mt-3">{{ vehicle.description }}</p>

            {% if vehicle.is_available and vehicle.status == "approved" and not active_booking %}
            <a href="{% url 'create_booking' vehicle.id %}"
            class="btn btn-success mt-3">
            Book Vehicle
            </a>
            {% else %}
                <span class="badge bg-danger mt-3">
                    Currently Unavailable
                </span>
            {% endif %}

          
    </div>

</div>
<!-- Leaflet CSS & JS (FREE) -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Get coordinates from Django context
      const latitude = {{ latitude|default:"27.7172" }};
      const longitude = {{ longitude|default:"85.3240" }};

      // Initialize map
      const map = L.map('map').setView([latitude, longitude], 13);

      // Add tile layer
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);

      // Add marker
      L.marker([latitude, longitude]).addTo(map)
          .bindPopup('{{ vehicle.vehicle_name }} Pickup Location')
          .openPopup( );
  });






</script>

{% endblock %}
